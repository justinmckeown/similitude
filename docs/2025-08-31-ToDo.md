# What’s left for MVP (my list)

1. Hashing beyond strong hash
- Perceptual / content‑aware:
    - **pHash/aHash** for images (via Pillow) – adapter behind a `SimilarityPort`.
    - **ssdeep** (fuzzy hashing) for text/binaries – optional extra.
    - **SimHash** for text (shingling) – optional extra.
- Plumbing:
    - Extend `IndexPort.upsert_hashes` fields (you already have `phash`/`ssdeep` columns).
    - A `SimilarityService` method to propose “near duplicates” (thresholded).
- CLI:
    - `similitude scan --enable phash,ssdeep` (feature flags).
    - `similitude report --mode similar|exact` (exact = current; similar = new).


2. Error handling strategy
- Exceptions taxonomy:
    - `PersistenceError`, `HashingError`, `FilesystemError`, `ConfigurationError`.
- Logging policy:
    - `INFO` for start/finish and counts; `WARNING` for recoverable skips; `ERROR` for hard failures; `DEBUG` for per‑file traces (behind `--verbose`).
- Tight, local try/except:
    - In `ScanService`: isolate filesystem open/read and each hasher call; log + continue.
    - In adapters: let `sqlite3.Error` bubble; services catch and wrap as `PersistenceError` where appropriate.
- CLI UX:
    - Exit non‑zero on unrecoverable init errors (e.g., DB not writable); otherwise process as much as possible and summarize failures.
    - `--fail-fast/--no-fail-fast` toggle (default: no fail fast).


3. Quick Start guide
- `docs/quickstart.md` with:
    - Install (pipx / venv), minimal scan/report examples, typical ignore patterns, CSV/JSON examples, and how to interpret a “cluster”.
    - Safety note: MVP does **not** delete files; it only reports.
    - Troubleshooting: permissions, long paths on Windows, excluding system folders.


# Additional small-but-MVP items I recommend
4. Ignore & include configuration
- Support `--ignore-from .similitudeignore` (gitignore‑style) and `--include` globs.
- Document common patterns (`node_modules`, `.git`, `*.tmp`, `*.log`).
5. Progress & UX polish
- `--progress` (simple per‑N files ticker) and `--quiet`.
- Final summary: scanned N, indexed M, skipped S (ignored/unreadable), errors E.
6. Deterministic output guarantees
- Ensure cluster member sort (by `path`, already in place) is applied consistently for all report formats.
7. Schema/version stamp
- Write `kv(schema_version=1)` at init; stub a migration entry point for future changes.
8. Packaging polish
- Confirm console entry point works on Windows (`pyproject` done), and `--version`/`--help` are clean.
- Verify wheels build locally.


# Concrete next steps (bite‑sized)
- Hashing:
    - Add a **`similarity` adapters module** with:
        - `ImagePHashAdapter` (Pillow, optional extra `Pillow`).
        - `SsdeepAdapter` (optional extra `ssdeep`).
        - Wire to `ScanService` with flags (don’t compute unless enabled).
    - Extend `cli scan` with `--enable phash,ssdeep,simhash` and pass booleans to `ScanService`.
    - Add a `SimilarityService.suggest_near_duplicates(threshold=…)` that:
        - groups by size bucket (or prehash) then compares `phash` Hamming distance ≤ K or `ssdeep` score ≥ T.
        - For MVP: start with **exact duplicates only in reports**; expose `--mode similar` as experimental (behind a feature flag) if time permits.
- Error handling:
    - Add `domain/errors.py` with the small exception hierarchy.
    - Replace broad catches with specific ones where we read/hash files; log, continue.
    - CLI: return code `2` on initialization/config errors; `0` otherwise, even with per‑file warnings (summarized).
- Quick Start:
    - I can draft `docs/quickstart.md` in one go—install, scan, report, examples, and a 60‑second “try it on a temp dir” block.
